<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="ico_4.png">
    <link rel="apple-touch-icon" href="ico_4.png">
    <link rel="apple-touch-icon" sizes="512x512" href="ico_4.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>–ù–∞–º–∞–∑</title>
    <style>
        * { margin: 0;
            padding: 0;
            box-sizing: border-box;}
        body {
            font-family: Arial, sans-serif;
            width: 100vw;
            min-height: 100vh;
            padding: 8px;
            background: linear-gradient(135deg, #0c1445 0%, #1a237e 50%, #283593 100%);
            color: white;}
        .container {
            max-width: 100%;
            margin: 0 auto;}
        .header {
            text-align: center;
            margin-bottom: 8px;
            padding: 0px 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);}
        .header h1 {
            font-size: clamp(24px, 6vw, 32px);
            margin-top: 0px;
            margin-bottom: 0px;
            background: linear-gradient(45deg, #fff, #a8d8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;}
        .date {
            font-size: clamp(16px, 4vw, 20px);
            opacity: 0.9;
            margin-bottom: 5px;}
        .time {
            font-size: clamp(18px, 5vw, 24px);
            font-weight: bold;
            opacity: 0.9;}
        .prayer-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 8px;
            font-family: monospace;
            font-size: clamp(16px, 4vw, 20px);
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);}
        .prayer-table th, .prayer-table td {
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);}
        .prayer-table th {
            background-color: rgba(255, 255, 255, 0.2);
            font-weight: bold;
            text-align: center;
            font-size: clamp(14px, 3vw, 18px);}
        /* –¶–≤–µ—Ç–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω –Ω–∞–º–∞–∑–∞ */
        .fajr {background: linear-gradient(90deg, rgba(25, 25, 112, 0.9) 0%, rgba(65, 105, 225, 0.7) 100%);}
        .sunrise {background: linear-gradient(90deg, rgba(255, 140, 0, 0.9) 0%, rgba(255, 165, 0, 0.7) 100%);}
        .dhuhr {background: linear-gradient(90deg, rgba(255, 215, 0, 0.9) 0%, rgba(255, 255, 0, 0.7) 100%);}
        .asr {background: linear-gradient(90deg, rgba(255, 140, 0, 0.7) 0%, rgba(255, 69, 0, 0.5) 100%);}
        .maghrib {background: linear-gradient(90deg, rgba(178, 34, 34, 0.9) 0%, rgba(255, 69, 0, 0.7) 100%);}
        .isha {background: linear-gradient(90deg, rgba(25, 25, 112, 0.7) 0%, rgba(0, 0, 139, 0.9) 100%);}
        button {
            padding: 15px 25px;
            font-size: clamp(16px, 4vw, 18px);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.2s;}
        button:active {
            transform: scale(0.98);}
        .settings-page {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-top: 0px;
            backdrop-filter: blur(10px);}
        .settings-group {
            margin-bottom: 20px;}
        .settings-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;}
        input[type="text"] {
            width: 100%;
            padding: 12px;
            margin: 5px 0;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            font-size: 16px;}
        .radio-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 10px 0;}
        .radio-option {
            display: flex;
            align-items: center;
            margin-right: 15px;}
        .save-btn {background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);}
        .reset-btn {background: linear-gradient(135deg, #f44336 0%, #da190b 100%);}
        .error {
            color: #ff6b6b;
            margin-top: 5px;
            font-size: 14px;}
        .white-night {
            color: #a8d8ff;
            font-style: italic;
            text-align: center;
            margin-top: 2px;
            padding: 12px;
            margin-bottom: 8px;
            background: rgba(168, 216, 255, 0.2);
            border-radius: 8px;
            font-size: clamp(14px, 3vw, 16px);}
        @media (min-width: 768px) {
            .container {
                max-width: 480px;}
            .prayer-table {
                font-size: 18px;}
            button {
                width: auto;
                margin-top: 0;}
            .button-group {
                display: flex;
                gap: 10px;}
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ -->
        <div id="mainPage">
            <div class="header">
                <h1>–í—Ä–µ–º—è –Ω–∞–º–∞–∑–æ–≤</h1>
                <div class="date" id="currentDate"></div>
                <div class="time" id="currentTime"></div>
            </div>
            <div id="prayerTimesTable"></div>
            <div class="button-group">
                <button onclick="showSettings()">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settingsPage" class="settings-page">
            <div class="settings-group">
                <label>–®–∏—Ä–æ—Ç–∞</label>
                <input type="text" id="latitude" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 55.7558">
                <div id="latitudeError" class="error"></div>
            </div>

            <div class="settings-group">
                <label>–î–æ–ª–≥–æ—Ç–∞</label>
                <input type="text" id="longitude" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 37.6173">
                <div id="longitudeError" class="error"></div>
            </div>

            <div class="settings-group">
                <label>–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å</label>
                <input type="text" id="timezone" value="0">
                <div id="timezoneError" class="error"></div>
            </div>

            <div class="settings-group">
                <label>–ü–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è –ª–∏ –≤—Ä–µ–º—è –Ω–∞ –ª–µ—Ç–Ω–µ–µ/–∑–∏–º–Ω–µ–µ</label>
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="daylightYes" name="daylight" value="1">
                        <label for="daylightYes">–î–∞</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="daylightNo" name="daylight" value="0" checked>
                        <label for="daylightNo">–ù–µ—Ç</label>
                    </div>
                </div>
            </div>

            <div class="settings-group">
                <label>–£–≥–æ–ª 1 (—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—É–º–µ—Ä–∫–∏)</label>
                <input type="text" id="angle1" value="18">
                <div id="angle1Error" class="error"></div>
            </div>

            <div class="settings-group">
                <label>–£–≥–æ–ª 2 (–≤–µ—á–µ—Ä–Ω–∏–µ —Å—É–º–µ—Ä–∫–∏)</label>
                <input type="text" id="angle2" value="17">
                <div id="angle2Error" class="error"></div>
            </div>

            <div class="button-group">
                <button class="save-btn" onclick="saveSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button class="reset-btn" onclick="resetToDefault()">–°–±—Ä–æ—Å–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        /*
------------------------
     ‚†Ñ‚†Ç‚†Ç‚¢Ç‚†® üîÖ ‚≠ë‚òΩ

   –í–æ—Å—Ö–æ–¥ –∏ –∑–∞—Ö–æ–¥ –°–æ–ª–Ω—Ü–∞ 
–ù–ï–í–û–ó–ú–û–ñ–ù–û –¢–û–ß–ù–û —Ä–∞—Å—Å—á–∏—Ç
–∞—Ç—å, –∏–∑-–∑–∞ –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–π —Ä
–µ—Ñ—Ä–∞–∫—Ü–∏–∏, –≤—ã—Å–æ—Ç—ã –Ω–∞–±–ª—é–¥–∞
—Ç–µ–ª—è –∏ —Ä–µ–ª—å–µ—Ñ–∞ –º–µ—Å—Ç–Ω–æ—Å—Ç–∏
  –†–∞—Å—á–µ—Ç–Ω–æ–µ –≤—Ä–µ–º—è –≤—Å–µ–≥–¥–∞
–±—É–¥–µ—Ç –∏–º–µ—Ç—å –ø–æ–≥—Ä–µ—à–Ω–æ—Å—Ç—å 
–¥–æ –æ–¥–Ω–æ–π –º–∏–Ω—É—Ç—ã –∏ –±–æ–ª–µ–µ!
  –ó–∞ –æ—Å–Ω–æ–≤—É —Ä–∞—Å—Å—á–µ—Ç–æ–≤ –≤–∑
—è—Ç –∞–ª–≥–æ—Ä–∏—Ç–º –ø–æ–ª–æ–∂–µ–Ω–∏—è –°–æ
–ª–Ω—Ü–∞ USNO. –î–æ–±–∞–≤–ª–µ–Ω –∏—Ç–µ—Ä
–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –¥–ª—è –±–æ–ª–µ–µ
—Ç–æ—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–∫–≤–∞
—Ç–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç. –î–æ
–±–∞–≤–ª–µ–Ω —É—á–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä–Ω–æ–π
—Ä–µ—Ñ—Ä–∞–∫—Ü–∏–∏ –¥–ª—è —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω—ã
—Ö –∑–Ω–∞—á–µ–Ω–∏–π (1013.25 –≥–ü–∞,
13*–°) —Å–æ–≥–ª–∞—Å–Ω–æ Meeus 2–≥–æ
–∏–∑–¥–∞–Ω–∏—è. –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–∞—Å—Å—á
–µ—Ç –±–µ–ª—ã—Ö –Ω–æ—á–µ–π –º–µ—Ç–æ–¥–æ–º —Å
–¥–≤–∏–≥–∞ —à–∏—Ä–æ—Ç—ã –∫ —é–≥—É –¥–æ –±–ª
–∏–∂–∞–π—à–µ–≥–æ –º–µ—Å—Ç–∞ –≥–¥–µ –Ω–∞—Å—Ç—É
–ø–∞–µ—Ç –∞—Å—Ç—Ä–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –Ω–æ—á
—å
       -----------
‚†Å‚¢Ä       –ê–≤—Ç–æ—Ä:
  ‚†Ñ–ü–∞—á–∫—É–ª—è –ü—ë—Å—Ç—Ä–µ–Ω—å–∫–∏–π
  ‚†Ñ   –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏:
 ‚†Ç       –¢–æ—â–µ–≥       ‚†à
   ‚†Ñ‚†à –ß—É–ª–∏–∫‚ú∂–¢–æ—Ç–æ—â ‚°Ä ‚°Å ‚†Å


        */
        // –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è —Ä–∞—Å—á–µ—Ç–æ–≤
        const months_short = ['–Ø–ù–í', '–§–ï–í', '–ú–ê–†', '–ê–ü–†', '–ú–ê–ô', '–ò–Æ–ù', '–ò–Æ–õ', '–ê–í–ì', '–°–ï–ù', '–û–ö–¢', '–ù–û–Ø', '–î–ï–ö'];
        const namazlar = ['–§–∞–¥–∂—Ä', '–í–æ—Å—Ö–æ–¥', '–ó—É—Ö—Ä', '–ê—Å—Ä', '–ú–∞–≥—Ä–∏–±', '–ò—à–∞'];
        const prayerClasses = ['fajr', 'sunrise', 'dhuhr', 'asr', 'maghrib', 'isha'];
        const no_night = "\"–ë–µ–ª—ã–µ –Ω–æ—á–∏\" - –∞–±—Å–æ–ª—é—Ç–Ω–∞—è –Ω–æ—á—å –Ω–µ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç, —Ä–∞—Å—Å—á–µ—Ç –§–∞–¥–∂—Ä –∏ –ò—à–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω –¥–ª—è –±–ª–∏–∂–∞–π—à–µ–≥–æ –º–µ—Å—Ç–∞ –≥–¥–µ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç –Ω–æ—á—å";

        // ==================== –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò ====================
        function is_leap(y) {
            return (y % 4 === 0 && (y % 100 !== 0 || y % 400 === 0));
        }

        function ut2dt(ut) {
            ut = Math.round(ut);
            let days = Math.floor(ut / 86400);
            let seconds_remaining = ut % 86400;
            let hours = Math.floor(seconds_remaining / 3600);
            seconds_remaining %= 3600;
            let minutes = Math.floor(seconds_remaining / 60);
            let seconds = seconds_remaining % 60;
            let year = 1970;

            while (days >= (is_leap(year) ? 366 : 365)) {
                days -= is_leap(year) ? 366 : 365;
                year++;
                if (year > 2100) break;
            }

            const month_days = [31, 28 + (is_leap(year) ? 1 : 0), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            let month = 1;
            for (let md of month_days) {
                if (days < md) break;
                days -= md;
                month++;
                if (month > 12) {
                    month = 1;
                    year++;
                }
            }
            return [year, month, days + 1, hours, minutes, seconds];
        }

        function dt2ut(year, month, day, hour = 0, minute = 0, second = 0) {
            if (year < 1970 || month < 1 || month > 12 || day < 1 || day > 31) {
                return 0;
            }

            let days = 0;
            for (let y = 1970; y < year; y++) {
                days += is_leap(y) ? 366 : 365;
            }

            const month_days = [31, 28 + (is_leap(year) ? 1 : 0), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            for (let m = 0; m < month - 1; m++) {
                days += month_days[m];
            }
            days += day - 1;
            return days * 86400 + hour * 3600 + minute * 60 + second;
        }

        function get_weekday(year, month, day) {
            if (month < 1 || month > 12 || day < 1 || day > 31) return 0;

            let m = month;
            let y = year;
            if (m < 3) {
                m += 12;
                y -= 1;
            }
            let k = y % 100;
            let j = Math.floor(y / 100);
            let h = (day + Math.floor(13 * (m + 1) / 5) + k + Math.floor(k / 4) + Math.floor(j / 4) + 5 * j) % 7;
            let r = (h + 6) % 7;
            return r;
        }

        function get_last_sunday(year, month, hour, minute, second, time_zone) {
            const month_days = [31, 28 + (is_leap(year) ? 1 : 0), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            if (month < 1 || month > 12) return 0;

            const last_day = month_days[month - 1];
            const last_weekday = get_weekday(year, month, last_day);
            const last_sunday_day = last_day - last_weekday;
            const ut = dt2ut(year, month, last_sunday_day, hour, minute, second);
            return ut - time_zone * 3600;
        }

        function is_dst(ut, time_zone, dst) {
            const dst_num = parseInt(dst, 10);
            if (dst_num === 0) {
                return 0;
            }

            try {
                const [year, month, day, hour, minute, second] = ut2dt(ut);
                const dst_start = get_last_sunday(year, 3, 2, 0, 0, time_zone);
                const dst_end = get_last_sunday(year, 10, 2, 0, 0, time_zone);
                const r = (dst_start <= ut && ut < dst_end) ? 1 : 0;
                return r;
            } catch (e) {
                console.error("Error in is_dst:", e);
                return 0;
            }
        }

        function normalize(value, base) {
            if (base === 0) return value;
            return value - base * Math.floor(value / base);
        }

        function f_to_hms(hh) {
            if (isNaN(hh) || !isFinite(hh)) {
                return [0, 0, 0];
            }

            let hours = Math.floor(hh);
            let minutes = (hh - hours) * 60;
            let min_int = Math.floor(minutes);
            let seconds = (minutes - min_int) * 60;
            let sec_int = Math.round(seconds);

            if (sec_int >= 60) {
                sec_int = 0;
                min_int += 1;
            }
            if (min_int >= 60) {
                min_int = 0;
                hours += 1;
            }
            if (hours >= 24) {
                hours -= 24;
            }
            return [hours, min_int, sec_int];
        }

        function f_to_hms_str(hours_decimal) {
            if (isNaN(hours_decimal) || !isFinite(hours_decimal)) {
                return "--:--:--";
            }

            hours_decimal = normalize(hours_decimal, 24);
            const [h, m, s] = f_to_hms(Math.abs(hours_decimal));
            return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        // ==================== –ê–°–¢–†–û–ù–û–ú–ò–ß–ï–°–ö–ò–ï –†–ê–°–ß–ï–¢–´ ====================
        function calc_jd(ut) {
            return 2440587.5 + (ut / 86400.0);
        }

        function usno_sun(ut) {
            try {
                const jd = calc_jd(ut);
                const D = jd - 2451545.0;
                let g = normalize(357.5291092 + 0.985600274 * D, 360);
                let q = normalize(280.4664567 + 0.985647366286 * D, 360);
                let L = normalize(q + 1.915 * Math.sin(g * Math.PI / 180) + 0.020 * Math.sin(2 * g * Math.PI / 180), 360);
                let e = normalize(23.439 - 0.00000036 * D, 360);
                e = normalize(e + 0.00256 * Math.cos((125.04 - 1934.136 * D / 36525) * Math.PI / 180), 360);
                let ra = Math.atan2(Math.cos(e * Math.PI / 180) * Math.sin(L * Math.PI / 180), Math.cos(L * Math.PI / 180)) * 180 / Math.PI;
                const dec = Math.asin(Math.sin(e * Math.PI / 180) * Math.sin(L * Math.PI / 180)) * 180 / Math.PI;
                if (ra < 0) ra += 360;
                const EqT = (q - ra) / 15.0;
                ra /= 15.0;
                const R = 1.00014 - 0.01671 * Math.cos(g * Math.PI / 180) - 0.00014 * Math.cos(2 * g * Math.PI / 180);
                const SD = 0.26656 / R;
                return [ra, dec, EqT, SD];
            } catch (e) {
                console.error("Error in usno_sun:", e);
                return [0, 0, 0, 0];
            }
        }

        function calculate(latitude, longitude, ut, morning_twilight, evening_twilight) {
            try {
                morning_twilight = Math.abs(morning_twilight);
                evening_twilight = Math.abs(evening_twilight);
                const [ra, dec, EqT, SD] = usno_sun(ut);

                function meeus_refraction(altitude_deg, pressure = 1013.25, temperature = 13) {
                    if (altitude_deg <= -1) return 0.0;
                    const P0 = 1010, T0 = 283.0;
                    let R_deg;

                    if (altitude_deg > 15) {
                        const z = 90.0 - altitude_deg;
                        const tan_z = Math.tan(z * Math.PI / 180);
                        const R_arcsec = 58.276 * tan_z - 0.0824 * Math.pow(tan_z, 3);
                        R_deg = R_arcsec / 3600.0;
                    } else {
                        const R_arcmin = 1.0 / Math.tan((altitude_deg + 7.31 / (altitude_deg + 4.4)) * Math.PI / 180);
                        R_deg = R_arcmin / 60.0;
                    }
                    return R_deg * (pressure / P0) * (T0 / (273.0 + temperature));
                }

                function Level(angle) {
                    if (isNaN(angle)) return false;

                    const numerator = Math.sin(-angle * Math.PI / 180) - Math.sin(dec * Math.PI / 180) * Math.sin(latitude * Math.PI / 180);
                    const denominator = Math.cos(dec * Math.PI / 180) * Math.cos(latitude * Math.PI / 180);

                    if (Math.abs(denominator) < 1e-10 || Math.abs(numerator) > Math.abs(denominator)) {
                        return false;
                    }

                    const cos_val = numerator / denominator;
                    if (Math.abs(cos_val) > 1) return false;

                    return Math.acos(cos_val) * 180 / Math.PI / 15;
                }

                const t = [0, 0, 0, 0, 0, 0, 0, 0];
                t[0] = 12 - longitude / 15.0 - EqT;

                const angle = SD + meeus_refraction(0);
                const lvl_val = Level(angle);
                t[1] = lvl_val !== false ? t[0] - lvl_val : false;
                t[2] = lvl_val !== false ? t[0] + lvl_val : false;

                const asr_angle = Math.atan(1.0 / (1.0 + Math.tan(Math.abs(latitude - dec) * Math.PI / 180))) * 180 / Math.PI;
                const asr_angle_corr = asr_angle - meeus_refraction(asr_angle);
                const asr_level = Level(-asr_angle_corr);
                t[3] = asr_level !== false ? t[0] + asr_level : false;

                let ff = Level(morning_twilight);
                let ii = Level(evening_twilight);
                t[6] = (ff === false) || (ii === false);
                t[7] = t[6];

                // –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–ª—ã—Ö –Ω–æ—á–µ–π
                if (t[6]) {
                    let adjusted_latitude = Math.acos(-Math.sin(-morning_twilight * Math.PI / 180)) * 180 / Math.PI - dec;
                    adjusted_latitude -= 9e-8;
                    latitude = adjusted_latitude;
                    ff = Level(morning_twilight);
                    ii = Level(evening_twilight);
                }
                t[4] = ff !== false ? t[0] - ff : false;
                t[5] = ii !== false ? t[0] + ii : false;
                return [t[4], t[1], t[0], t[3], t[2], t[5], t[6], t[7]];
            } catch (e) {
                console.error("Error in calculate:", e);
                return [false, false, false, false, false, false, false, false];
            }
        }

        function calc_plus(latitude, longitude, ut, morning_twilight, evening_twilight) {
            try {
                const t = calculate(latitude, longitude, ut, morning_twilight, evening_twilight);
                const r = [0, 0, 0, 0, 0, 0, false, false];
                let last_p = null;

                for (let i = 0; i < 6; i++) {
                    if (t[i] === false) {
                        r[i] = false;
                        continue;
                    }
                    last_p = calculate(latitude, longitude, ut - 43200 + t[i] * 3600, morning_twilight, evening_twilight);
                    r[i] = last_p[i];
                }
                r[6] = r[7] = last_p ? (last_p[6] && last_p[7]) : false;
                return r;
            } catch (e) {
                console.error("Error in calc_plus:", e);
                return [false, false, false, false, false, false, false, false];
            }
        }

        // ==================== –û–°–ù–û–í–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø ====================
        function get_today(latitude, longitude, time_zone, dst, morning_twilight, evening_twilight) {
            const lat = parseFloat(latitude);
            const lon = parseFloat(longitude);
            const tz = parseInt(time_zone, 10);
            const dst_num = parseInt(dst, 10);
            const morn_tw = parseFloat(morning_twilight);
            const even_tw = parseFloat(evening_twilight);

            if (isNaN(lat) || isNaN(lon) || isNaN(tz) || isNaN(dst_num) || 
                isNaN(morn_tw) || isNaN(even_tw)) {
                return {error: "–û—à–∏–±–∫–∞: –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞"};
            }

            try {
                let ut = Date.now() / 1000;
                ut = ut - (ut % 86400) + 12 * 3600;
                //ut = dt2ut(2025,5,25)

                const t = calc_plus(lat, lon, ut, morn_tw, even_tw);
                const p = calc_plus(lat, lon, ut + 86400, morn_tw, even_tw);

                const today_offset = tz + is_dst(ut, tz, dst_num);
                const tomorrow_offset = tz + is_dst(ut + 86400, tz, dst_num);

                const [_, month, day, __, ___, ____] = ut2dt(ut + today_offset * 3600);

                const result = {
                    date: `${day.toString().padStart(2, '0')} ${months_short[month - 1]}`,
                    times: [],
                    hasWhiteNights: false
                };

                for (let i = 0; i < 6; i++) {
                    const tt_offset = tz + is_dst(ut + t[i] * 3600.0, tz, dst_num);
                    const tp_offset = tz + is_dst(ut + p[i] * 3600.0 + 86400, tz, dst_num);

                    let todayTime = t[i] !== false ? f_to_hms_str(t[i] + tt_offset) : "--:--:--";
                    let tomorrowTime = p[i] !== false ? f_to_hms_str(p[i] + tp_offset) : "--:--:--";

                    let isWhiteNight = false;
                    if (t[6]) {
                        if (i === 0 || i === 5) {
                            isWhiteNight = true;
                            result.hasWhiteNights = true;
                        }
                    }

                    result.times.push({
                        name: namazlar[i],
                        today: todayTime,
                        tomorrow: tomorrowTime,
                        isWhiteNight: isWhiteNight,
                        class: prayerClasses[i]
                    });
                }

                return result;
            } catch (e) {
                console.error("Error in get_today:", e);
                return {error: "–û—à–∏–±–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–º–∞–∑–æ–≤"};
            }
        }

        function validateInputs() {
            let isValid = true;

            document.querySelectorAll('.error').forEach(el => el.textContent = '');

            const latitude = parseFloat(document.getElementById('latitude').value);
            if (isNaN(latitude) || latitude < -90 || latitude > 90) {
                document.getElementById('latitudeError').textContent = '–®–∏—Ä–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç -90 –¥–æ 90';
                isValid = false;
            }

            const longitude = parseFloat(document.getElementById('longitude').value);
            if (isNaN(longitude) || longitude < -180 || longitude > 180) {
                document.getElementById('longitudeError').textContent = '–î–æ–ª–≥–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç -180 –¥–æ 180';
                isValid = false;
            }

            const timezone = parseFloat(document.getElementById('timezone').value);
            if (isNaN(timezone) || timezone < -12 || timezone > 14) {
                document.getElementById('timezoneError').textContent = '–ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç -12 –¥–æ 14';
                isValid = false;
            }

            const angle1 = parseFloat(document.getElementById('angle1').value);
            if (isNaN(angle1) || angle1 < -90 || angle1 > 90) {
                document.getElementById('angle1Error').textContent = '–£–≥–æ–ª 1 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç -90 –¥–æ 90';
                isValid = false;
            }

            const angle2 = parseFloat(document.getElementById('angle2').value);
            if (isNaN(angle2) || angle2 < -90 || angle2 > 90) {
                document.getElementById('angle2Error').textContent = '–£–≥–æ–ª 2 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —á–∏—Å–ª–æ–º –æ—Ç -90 –¥–æ 90';
                isValid = false;
            }

            return isValid;
        }

        function updateCurrentDateTime() {
            const now = new Date();
            const dateOptions = { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric'
            };
            const timeOptions = {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            };

            document.getElementById('currentDate').textContent = now.toLocaleDateString('ru-RU', dateOptions);
            document.getElementById('currentTime').textContent = now.toLocaleTimeString('ru-RU', timeOptions);
        }

        function updatePrayerTimes() {
            if (!validateInputs()) {
                document.getElementById('prayerTimesTable').innerHTML = '<div class="error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö</div>';
                return;
            }

            try {
                const latitude = document.getElementById('latitude').value;
                const longitude = document.getElementById('longitude').value;
                const time_zone = document.getElementById('timezone').value;
                const dst_element = document.querySelector('input[name="daylight"]:checked');
                const dst = dst_element ? dst_element.value : "0";
                const morning_twilight = document.getElementById('angle1').value;
                const evening_twilight = document.getElementById('angle2').value;
                const result = get_today(latitude, longitude, time_zone, dst, morning_twilight, evening_twilight);

                if (result.error) {
                    document.getElementById('prayerTimesTable').innerHTML = `<div class="error">${result.error}</div>`;
                    return;
                }

                let tableHTML = `
                    <table class="prayer-table">
                        <thead>
                            <tr>
                                <th>–ù–∞–º–∞–∑</th>
                                <th>–°–µ–≥–æ–¥–Ω—è (${result.date})</th>
                                <th>–ó–∞–≤—Ç—Ä–∞</th>
                            </tr>
                        </thead>
                        <tbody>
                `;

                result.times.forEach(prayer => {
                    const todayClass = prayer.isWhiteNight ? 'white-night' : prayer.class;
                    const tomorrowClass = prayer.isWhiteNight ? 'white-night' : prayer.class;

                    tableHTML += `
                        <tr>
                            <td>${prayer.name}</td>
                            <td class="${todayClass}">${prayer.today}</td>
                            <td class="${tomorrowClass}">${prayer.tomorrow}</td>
                        </tr>
                    `;
                });

                tableHTML += `
                        </tbody>
                    </table>
                `;

                if (result.hasWhiteNights) {
                    tableHTML += `<div class="white-night">${no_night}</div>`;
                }

                document.getElementById('prayerTimesTable').innerHTML = tableHTML;

            } catch (e) {
                console.error("Error in updatePrayerTimes:", e);
                document.getElementById('prayerTimesTable').innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–º–∞–∑–æ–≤</div>';
            }
        }

        function showSettings() {
            document.getElementById('mainPage').style.display = 'none';
            document.getElementById('settingsPage').style.display = 'block';
            loadSettings();
        }

        function loadSettings() {
            const saved = localStorage.getItem('astroSettings');
            if (saved) {
                try {
                    const settings = saved.split(';');
                    if (settings.length >= 6) {
                        document.getElementById('latitude').value = settings[0] || '';
                        document.getElementById('longitude').value = settings[1] || '';
                        document.getElementById('timezone').value = settings[2] || '0';

                        if (settings[3] === '1') {
                            document.getElementById('daylightYes').checked = true;
                        } else {
                            document.getElementById('daylightNo').checked = true;
                        }

                        document.getElementById('angle1').value = settings[4] || '18';
                        document.getElementById('angle1').value = settings[4] || '18';
                        document.getElementById('angle2').value = settings[5] || '17';

                    }
                } catch (e) {
                    console.error("Error loading settings:", e);
                }
            }
            updateCurrentDateTime();
            updatePrayerTimes();
        }

        function saveSettings() {
            if (!validateInputs()) {
                return;
            }

            try {
                const latitude = document.getElementById('latitude').value;
                const longitude = document.getElementById('longitude').value;
                const timezone = document.getElementById('timezone').value;
                const daylight = document.querySelector('input[name="daylight"]:checked')?.value || '0';
                const angle1 = document.getElementById('angle1').value;
                const angle2 = document.getElementById('angle2').value;

                const settingsString = [latitude, longitude, timezone, daylight, angle1, angle2].join(';');
                localStorage.setItem('astroSettings', settingsString);

                document.getElementById('settingsPage').style.display = 'none';
                document.getElementById('mainPage').style.display = 'block';
                updateCurrentDateTime();
                updatePrayerTimes();
            } catch (e) {
                console.error("Error saving settings:", e);
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫");
            }
        }

        function resetToDefault() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?")) {
                document.getElementById('latitude').value = '';
                document.getElementById('longitude').value = '';
                document.getElementById('timezone').value = '0';
                document.getElementById('daylightNo').checked = true;
                document.getElementById('angle1').value = '18';
                document.getElementById('angle2').value = '17';

                document.querySelectorAll('.error').forEach(el => el.textContent = '');

                localStorage.removeItem('astroSettings');
                updateCurrentDateTime();
                updatePrayerTimes();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('mainPage').style.display = 'block';
            document.getElementById('settingsPage').style.display = 'none';
            updateCurrentDateTime();
            loadSettings();

            setInterval(updateCurrentDateTime, 1000);
            setInterval(updatePrayerTimes, 30000);
        });
    </script>
</body>
</html>
